<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta tags for proper character encoding and responsiveness -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Page Title -->
    <title>iMTN App</title>

    <!-- Open Graph Meta Tags for link preview -->
    <meta property="og:title" content="iMTN App" />
    <meta property="og:description" content="يعرض التطبيق الباقات المتاحة والخدمات ويمكن للمستخدم تفعيل باقة أو خدمة معينة كما يمكن الاستعلام عن جميع الباقات المفعلة وعرض الاستهلاك" />
    
    <!-- Important: Full URL to the image for preview -->
    <meta property="og:image" content="https://res.cloudinary.com/dpdeknzho/image/upload/v1727269133/IMG_20240925_155814_678_ogtqz7.jpg" />
    
    <!-- Optional but recommended: specify image dimensions -->
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- The actual URL of the page being shared -->
    <meta property="og:url" content="https://res.cloudinary.com/dpdeknzho/image/upload/v1727269133/IMG_20240925_155814_678_ogtqz7.jpg" />
    
    <!-- Website type -->
    <meta property="og:type" content="website" />

    <!-- Optional: Name of the website or app -->
    <meta property="og:site_name" content="MTN SYR" />

    <!-- Optional: Twitter Card tags if you'd like a Twitter-specific preview -->
    <meta name="twitter:card" content="large_image">
    <meta name="twitter:title" content="iMTN App">
    <meta name="twitter:description" content="يعرض التطبيق الباقات المتاحة والخدمات ويمكن للمستخدم تفعيل باقة أو خدمة معينة كما يمكن الاستعلام عن جميع الباقات المفعلة وعرض الاستهلاك">
    <meta name="twitter:image" content="https://res.cloudinary.com/dpdeknzho/image/upload/v1727269133/IMG_20240925_155814_678_ogtqz7.jpg">

    <!-- reCAPTCHA v3 client script (replace YOUR_SITE_KEY) -->
    <script src="https://www.google.com/recaptcha/api.js?render=6Lez18QrAAAAAHRVudPm3hSQZMkAlFN-2ilGylQP"></script>
    
</head>
<body>
    <p id="status">Preparing download…</p>

  <script>
    const SITE_KEY = '6Lez18QrAAAAAHRVudPm3hSQZMkAlFN-2ilGylQP'; // <--- put your site key here
    const WORKER_URL = 'https://recabachav3.digitalservices-mtn.workers.dev/'; // <--- change to your Worker URL
    const DOWNLOAD_URL = 'https://devdigitalmtn.github.io/iMTN/assets/iMTN_1.0.6.apk'

    const statusEl = document.getElementById('status');
    function setStatus(t){ statusEl.textContent = t; }

    grecaptcha.ready(() => {
      setStatus('Running security check...');
      // action 'download' is an arbitrary label — we'll expect the same on server
      grecaptcha.execute(SITE_KEY, { action: 'download' }).then(token => {
        // send token to Cloudflare Worker for server-side verification
        fetch(WORKER_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token, action: 'download' })
        })
        .then(r => r.json())
        .then(json => {
          if (json.success) {
            setStatus('Verified ✓ Redirecting to download...');
            // short delay to show message then redirect
            setTimeout(() => window.location.href = DOWNLOAD_URL, 300);
          } else {
            console.warn('reCAPTCHA failed', json);
            setStatus('Verification failed. Try again later.');
            // optionally show a manual link or retry button
          }
        })
        .catch(err => {
          console.error(err);
          setStatus('Network or server error during verification.');
        });
      });
    });
  </script>
</body>
</html>
